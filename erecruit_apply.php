





<head>
  <meta name="msvalidate.01" content="09A02B8D3F007D4FBAD02C60BEA679F0" />  
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">	
		<title>
			Talener		</title>

			    <meta name="viewport" content="width=device-width">
	
		<link rel="stylesheet" type="text/css" href="http://www.talener.com/wp-content/themes/talener/style.css" media="screen" />
		<link rel="alternate" type="application/rss+xml" title="Talener RSS Feed" href="http://www.talener.com/feed/" />
		<link rel="pingback" href="http://www.talener.com/xmlrpc.php" />
		<link rel="shortcut icon" href="http://www.talener.com/wp-content/themes/talener/images/favicon.ico" type="image/x-icon">
		<link rel="icon" href="http://www.talener.com/wp-content/themes/talener/images/favicon.ico" type="image/x-icon">
		<!--[if lt IE 9]>
		<script src="http://ie7-js.googlecode.com/svn/version/2.1(beta4)/IE9.js">IE7_PNG_SUFFIX=".png";</script>
		<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]--> 
		
		<script src="http://www.talener.com/wp-content/themes/talener/js/vendor/modernizr-2.6.2.min.js"></script>
		<link href='http://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
		<link href='http://fonts.googleapis.com/css?family=Muli:400,400italic' rel='stylesheet' type='text/css'>
		<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
		<script src="js/formv.js"></script>
<style>
#applynow {
    background-color: grey;
    margin: 40px;
padding:20px;
position:relative;
top:150px;
} 

</style>



   <div id="mobile-menu">
    <div class="menu-mobile-menu-container"><ul id="menu-mobile-menu" class="menu"><li id="menu-item-22017" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-14599 current_page_item menu-item-22017"><a href="http://www.talener.com/">Talener: Your Only IT Staffing Solution</a></li>
<li id="menu-item-22019" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-22019"><a href="http://www.talener.com/candidates/">Candidates</a>
<ul class="sub-menu">
	<li id="menu-item-22020" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-22020"><a href="http://www.talener.com/candidates/job-listings/">Job Listings</a></li>
	<li id="menu-item-22021" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-22021"><a href="http://www.talener.com/candidates/consultant-resources/">Consultant Resources</a></li>
	<li id="menu-item-22022" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-22022"><a href="http://www.talener.com/candidates/tips/">Tips &#038; Tricks</a></li>
</ul>
</li>
<li id="menu-item-22023" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-22023"><a href="http://www.talener.com/about/">Employers</a>
<ul class="sub-menu">
	<li id="menu-item-22024" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-22024"><a href="http://www.talener.com/about/team/">Team</a></li>
	<li id="menu-item-22025" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-22025"><a href="http://www.talener.com/about/testimonials/">Testimonials</a></li>
	<li id="menu-item-22026" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-22026"><a href="http://www.talener.com/about/work-at-talener/">Work at Talener</a></li>
</ul>
</li>
<li id="menu-item-22018" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-22018"><a href="http://www.talener.com/blog/">Blog</a></li>
<li id="menu-item-22027" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-22027"><a href="http://www.talener.com/contact/">Contact</a></li>
</ul></div>    <a class="mobile-close">Close</a>
    </div>
    <div class="header">
	    <div class="top-head">
	    	<div class="inner">
	    		<div class="tag">
		    	<i>Where Technology Meets Staffing</i>
		    	</div>
		    	
		    	<ul class="social-top">
		    		<li class="fb"><a href="http://www.facebook.com/pages/Talener-Group-NYC/130014800351250" target="_blank">Facebook</a></li>
		    		<li class="tw"><a href="http://twitter.com/talenerHQ" target="_blank">Twitter</a></li>
		    		<li class="li"><a href="http://www.linkedin.com/company/talener" target="_blank">LinkedIn</a></li>
		    		<li class="gp"><a href="https://plus.google.com/101510089960110340450/" target="_blank">Google+</a></li>
		    	</ul>
		    	
		    	<div class="header-call">
		    	<span>Call us anytime: </span>1-917-720-1080
		    	</div>
	    	</div>
	    </div>
	    <div class="nav">
	    	<div class="inner">
	    		<a href="http://www.talener.com"><h1>Talener</h1></a>
	    		<div class="menu-primary-menu-container"><ul id="menu-primary-menu" class="menu"><li id="menu-item-14598" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-14598"><a href="http://www.talener.com/candidates/">Candidates</a></li>
<li id="menu-item-14597" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-14597"><a href="http://www.talener.com/employers/">Employers</a></li>
<li id="menu-item-14596" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-14596"><a href="http://www.talener.com/about/">About Us</a></li>
<li id="menu-item-14595" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-14595"><a href="http://www.talener.com/blog/">Blog</a></li>
<li id="menu-item-14594" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-14594"><a href="http://www.talener.com/contact/">Contact</a></li>
</ul></div>	    		<a class="mobile-menu-trigger">Menu</a>
	    	</div>
	    </div>
    </div>
       <li>









<?php

//var_dump($_GET);
//var_dump($_REQUEST);


#Talener erecruit API intergration authored by Mario Moorhead Blackskymedia 2014 

##Settings
$serviceRoot = "http://erecruit.talener.com/restservices";
$entityID = "00000000-0000-0000-0000-000000000E01";
$username = "API@talener.com";
$password = "Pass123";
##End Settings
$createdByID = 'e137632b-ae1c-402b-8063-0afabe461361';
$alldone = 0;

// log on to RESTful service get CreatedByID and set cookie
$c = authenticate($serviceRoot, $username, $password, $entityID);



//grab email address if any from POST
$candiate = $_GET[email];
$positionID = $_GET[jobid];

// find erecruit positionID from WP post ID
//echo $positionID;
$con=mysqli_connect("localhost","talenerc_wp","YqRyqM7R2FX","talenerc_wp");
// Check connection
if (mysqli_connect_errno()) {
  echo "Failed to connect to MySQL: " . mysqli_connect_error();
}

$result = mysqli_query($con,"SELECT er_id FROM talenwp_tempbase WHERE wp_id = $positionID LIMIT 1");
while($row = mysqli_fetch_array($result)) {
  $positionID = $row['er_id'];
}

mysqli_close($con);



$newCandidate = array();
$newCandidate = $_REQUEST;

//var_dump($newCandidate);
if ( $newCandidate[FirstName] != NULL); {
	//echo 'we got a new candiate';
}


$whodat = '';

if ($candiate != null && $candiate != '') {
	$results2 = findCandidate($c, $serviceRoot, $candiate, $entityID);
	echo 'this works---> '.$candiate.' ';

	/**
	 * here we have the result in a string it is not xml and needs to be parsed
	 **/
	$jobLisiting = array();
	$p = xml_parser_create();
	xml_parse_into_struct($p, $results2, $vals, $index);
	xml_parser_free($p);


	$record = 1;

	for ($i=0; $i < 280; $i++) { 
		
		if($vals[$i] == null)
			break;

		if($vals[$i]['tag'] == 'CANDIDATEID'){
			$cID = $vals[$i]['value'];
			//echo 'Candidate ID '.$cID;
			$goodvibes = 1;
		}
		
		//echo $vals[$i]['tag'].$vals[$i]['value'];

	}

}

echo ' Variable goodvibes '.$goodvibes.' CID '.$cID;
// http://erecruit.talener.com/RestServices/Candidate/Do/Create"
// erecruit_apply_create.php

if ($cID < 1 || $cID == null){
		$goodvibes = 0;
			echo '<html>
	

	<title>
	Candidate
</title>

		<style>
			h5
			{
				margin-bottom: 2px;
			}
			
			div.item
			{
				float: left;
				margin-right: 10px;
			}
		</style>.
	</head>
	<body>
	<div id="applynow">
     <form name="applynow" action="erecruit_apply_create.php" enctype="multipart/form-data" onsubmit="return validateForm()" method="post">
      <fieldset>
        <legend>We could not find you in the system, please fill in fields to create an erecruit account. (Only first, last name and email required)</legend>
				
				<div class="item">
					<input id="CreatedByID" name="CreatedByID" type="hidden" value="e137632b-ae1c-402b-8063-0afabe461361" />
				</div>

				<div class="item">
					<h3>FirstName</h3>
					<input id="FirstName" name="FirstName" type="text" value="" />
				</div>
				
				<div class="item">
					<h3>LastName</h3>
					<input id="LastName" name="LastName" type="text" value="" />
				</div>
				
              	<div class="item">
					<h3>Email</h3>
					<input id="Email" name="Email" type="text" value="" />
				</div>
								
				<div class="item">
					<h3>MobilePhone</h3>
					<input id="MobilePhone" name="MobilePhone" type="text" value="" />
				</div>
				
				<div class="item">
					<input id="AdSource" name="AdSource" type="hidden" value="none" />
				</div>
				
				<div class="item">
					<input id="FolderGroupID" name="FolderGroupID" type="hidden" value="3" />
				</div>

				<div class="item">
					<input id="EntityID" name="EntityID" type="hidden" value="00000000-0000-0000-0000-000000000E01" />
				</div>

				<div class="item">
					<input id="Password" name="Password" type="hidden" value="Pass123" />
				</div>
				   
				<div class="item">
					<input id="OwnerID" name="OwnerID" type="hidden" value="e137632b-ae1c-402b-8063-0afabe461361" />
				</div>

				<div class="item">
					<input id="PositionID" name="PositionID" type="hidden" value="'.$positionID.'" />
				</div>
				           
        <h5 style="clear: both; margin-top: 10px;">&nbsp;</h5>
        
				<input type="submit" value="Add Candidate"  />
      </fieldset>
    </form>
</div>



	</body>
	</html>';
}


if ($goodvibes == 1) {

	//echo $cid;

	$candidateID = $cID;
	//$positionID = 8166;
	//$createdByID = 'e137632b-ae1c-402b-8063-0afabe461361';
	//$entityID = 'xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx';
	//$entityID = "00000000-0000-0000-0000-000000000";

	echo 'Found Candidate... Submitting application... ';
	$resumeData = 'this is my resume it is better then most but not better then all and I feel very very good about it';
	$fap = uploadResume($c, $serviceRoot, $candidateID, $entityID, $resumeData);
	
	//echo ' HERE WE HOPE FOR A RESUME FEEDBACK ';
	//var_dump($fap);

	//echo 'EntityID '.$entityID.' ';

	// createApplication($c, $serviceRoot, $entityID, $createdByID, $candidateID, $positionID)
	  $foo = createApplication($c, $serviceRoot, $entityID, $createdByID, $candidateID, $positionID);
	echo ' APPLICATION SENT! Good luck, you may close this window.';
	// $checker = '1000|';
	// $statusCheck = strpos($foo, $checker);
	// //var_dump($foo);
	// echo 'LIVE OUTPUT '.$foo;

	// if ($statusCheck === true)
	// 	echo ' NAILED IT ';
}



if ($_GET == null)	{
	echo '<html>
	<body>

	<form action="erecruit_apply.php" method="get">
	<p>Give us your email so we can find you</p>
	E-mail: <input type="text" name="email"><br>
	<input type="submit">
	</form>













	</body>
	</html>';
}















// <form action="/RestServices/Candidate/Do/Create" enctype="multipart/form-data" method="post">

if ($goodvibes != 1 && $_GET == NULL)
{
	echo '
	

<div id="applynow">
     <form action="/RestServices/Candidate/Do/Create" enctype="multipart/form-data" method="post">
      <fieldset>
        <legend>Test Candidate Functions</legend>

				<div class="item">
					<h5>ActionID</h5>
					<input id="ActionID" name="ActionID" type="text" value="" />
				</div>
				   
				<div class="item">
					<h5>OwnerID</h5>
					<input id="OwnerID" name="OwnerID" type="text" value="" />
				</div>
				           
        <h5 style="clear: both; margin-top: 10px;">&nbsp;</h5>
        <input type="submit" value="Add Note" />
				<input type="submit" value="Add Candidate" />
      </fieldset>
    </form>





		<form action="erecruit_apply_create.php" enctype="multipart/form-data" method="post">
	      <fieldset>
	        <legend>We could not find you in the system, please fill in fields to create an erecruit account</legend>

				
					<div class="item">
						<h5>FirstName</h5>
						<input id="FirstName" name="FirstName" type="text" value="" />
					</div>

				

				

					
					           
	        <h5 style="clear: both; margin-top: 10px;">&nbsp;</h5>
	       
					<input type="submit" value="Add Candidate" />
	      </fieldset>
	    </form>
</div>

	';
}





//$candidateData = array();

//$candidateData = array(
//"Title" => "mario Moorhead",
//"CreatedByID" => "11"
//);

//$apply = createCandidate($c, $serviceRoot, $candidateData);


//$candy = getCandidate($c, $serviceRoot, $candidateID, $entityID);

//var_dump($apply);





//$pippy = createApplication($c, $serviceRoot, $entityID, $createdByID, $candidateID, $positionID);

//var_dump($pippy);






## Returns an authorized curl resource that can be used with subsequent requests
function authenticate($serviceRoot, $username, $password, $entityID)
{
	$authenticate = $serviceRoot . "/Authenticate";
	
	$c = curl_init();
	
	curl_setopt($c, CURLOPT_URL, $authenticate);
	curl_setopt($c, CURLOPT_POST, true);
	curl_setopt($c, CURLOPT_RETURNTRANSFER, true);
	curl_setopt($c, CURLOPT_HEADER, true);
	curl_setopt($c, CURLINFO_HEADER_OUT, true);
	curl_setopt($c, CURLOPT_COOKIEFILE, 'cookie.txt');
	curl_setopt($c, CURLOPT_SSL_VERIFYPEER, false);
	curl_setopt($c, CURLOPT_VERBOSE, true);
	curl_setopt($c, CURLOPT_COOKIEJAR, 'cookie.txt');
	
	curl_setopt($c, CURLOPT_NOPROGRESS, true);
	
	$data = array('Username' => $username, 'Password' => $password, 'EntityID' => $entityID);
	curl_setopt($c, CURLOPT_POSTFIELDS, $data);
		
	$result = curl_exec($c);
//	var_dump($result);
	return $c;
}

function getCandidate($c, $serviceRoot, $candidateID, $entityID)
{
	$url = "$serviceRoot/Candidate/$entityID/$candidateID";
	
	curl_setopt($c, CURLOPT_URL, $url);
	curl_setopt($c, CURLOPT_HTTPGET, true);
	
	$result = curl_exec($c);
	echo 'PROBLEM HERE ';
	var_dump(curl_getinfo($c, CURLINFO_HEADER_OUT));
	return $result;
}


function createCandidate($c, $serviceRoot, $candidateData)
{
	$url = "$serviceRoot/Candidate/Do/Create";
	
	curl_setopt($c, CURLOPT_URL, $url);
	curl_setopt($c, CURLOPT_POST, true);

	
	curl_setopt($c, CURLOPT_POSTFIELDS, $candidateData);
	
	$result = curl_exec($c);
	
	return $result;
}

function updateCandidate($c, $serviceRoot, $entityID, $candidateID, $candidateData)
{
	$url = "$serviceRoot/Candidate/$entityID/$candidateID/Update";
	
	curl_setopt($c, CURLOPT_URL, $url);
	curl_setopt($c, CURLOPT_POST, true);
	
	curl_setopt($c, CURLOPT_POSTFIELDS, $candidateData);
	
	$result = curl_exec($c);
	
	return $result;
}

function findCandidate($c, $serviceRoot, $candiate, $entityID)
{
	//echo 'more';
	$url = "$serviceRoot/User/$entityID/$candiate";
	
	curl_setopt($c, CURLOPT_URL, $url);
	curl_setopt($c, CURLOPT_HTTPGET, true);
	curl_setopt($c, CURLOPT_HEADER, false);
	
	$result = curl_exec($c);
	//echo 'found candiate '.$result;
	//var_dump($result);
	//echo 'food';
	//print_r($result);
	//echo 'more';
	return $result;
}

function uploadAttachment($c, $serviceRoot, $attachmentData)
{
	$url = "$serviceRoot/Attachment/Do/UploadAttachment";
	
	curl_setopt($c, CURLOPT_URL, $url);
	curl_setopt($c, CURLOPT_POST, true);
		
	curl_setopt($c, CURLOPT_POSTFIELDS, $attachmentData);
	
	$result = curl_exec($c);
	return $result;
}

function uploadResume($c, $serviceRoot, $candidateID, $entityID, $resumeData)
{
	$url = "$serviceRoot/Candidate/$entityID/$candidateID/UploadResume";
	$createdByID = 'e137632b-ae1c-402b-8063-0afabe461361';

	curl_setopt($c, CURLOPT_URL, $url);
	curl_setopt($c, CURLOPT_POST, true);

	curl_setopt($c, CURLOPT_POSTFIELDS, array(
			"CreatedByID" => $createdByID,
			"CandidateID" => $candidateID,
			"ResumeData" => $resumeData,
			"EntityID" => $entityID));
	
	//curl_setopt($c, CURLOPT_POSTFIELDS, $resumeData);

	//curl_setopt($c, CURLOPT_POSTFIELDS, $CreatedByID);
	
	//echo ' I tried ';
	$result = curl_exec($c);
	return $result;
}

function createApplication($c, $serviceRoot, $entityID, $createdByID, $candidateID, $positionID)
{
	$url = "$serviceRoot/CandidateApplication/$entityID/Do/Create";
	
	curl_setopt($c, CURLOPT_URL, $url);
	curl_setopt($c, CURLOPT_POST, true);
	
	curl_setopt($c, CURLOPT_POSTFIELDS, array(
			"CreatedByID" => $createdByID,
			"PositionID" => $positionID,
			"CandidateID" => $candidateID,
			"ApplicationSource" => 'spoonface',
			"EntityID" => $entityID));
			
	$result = curl_exec($c);
	//var_dump($result);
	return $result;
}

$r = authenticate($serviceRoot, $username, $password, $entityID);
//var_dump($r[1]);

if ($create_candidate)
{
	$n = rand(1, 10000);
	$candidateData = array(
	 "FirstName" => "erecruit Test",
	 "NickName" => "",
	 "LastName" => "Candidate " . $n, 
	 "Email" => "testcandidate" . $n . "@erecruit.com",
	 "AdSource" => "Other",
	 "EntityID" => $entityID,
	 "FolderGroupID" => 1,
	 "CreatedByID" => '6E5AB85A-B786-42DE-B7A8-3DACD28957C2',
	 "AddressLine1" => "100 Main St",
	 "AddressLine2" => "Apt 2",
	 "City" => "Chicago",
	 "State" => "Illinois",
	 "Country" => "US",
	 "IsApproved" => "True",
	 "Password" => "test123",
	 "WithPermissions" => "True",
	 "Resume" => "@C:/Projects/php/erecruit/sampledoc.rtf",
	 "Gender" => "M",
	 "Ethnicity" => "Hispanic, Latino, or Spanish"
	);

	$result = createCandidate($r[0], $serviceRoot, $candidateData);
	var_dump($result);

	$x = new SimpleXMLElement($result);
	var_dump($x->Data->Message);
	$refID = $x->Data->Message;

	if ($x->Status == 0) return;

	$result = getCandidate($r[0], $serviceRoot, $x->Data->Message, $entityID);
	var_dump($result);

	$x = new SimpleXMLElement($result);
	var_dump($x->Data->Candidate->UserID);
}

if ($create_application)
{
	$result = createApplication($r[0], $serviceRoot, $entityID, '6E5AB85A-B786-42DE-B7A8-3DACD28957C2', $candidateID, $applicationPositionID);
echo 'POOPY TIME ';
	var_dump($result);
}

if ($update_candidate)
{
 $updateCandidateData = array(
	 "EthnicityID" => "200",
	 "ChangedByID" => "6E5AB85A-B786-42DE-B7A8-3DACD28957C2"
 );
 
 $result = updateCandidate($r[0], $serviceRoot, $entityID, $candidateID, $updateCandidateData);
 var_dump($result);
}
// curl_close($r[0]);

?>


